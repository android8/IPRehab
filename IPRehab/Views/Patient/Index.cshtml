@model IEnumerable<IPRehabWebAPI2.Models.PatientDTO>

@{
  ViewData["Title"] = "Index";
  Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>Patients</h1>

<p>
  <a asp-action="Create">Create New</a>
</p>
<table class="table">
  <thead>
    <tr>
      <th>
        @Html.DisplayNameFor(model => model.VISN)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Facility)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.District)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Division)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Sta6aKey)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Bedsecn)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.Name)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.PTFSSN)
      </th>
      <th>
        @Html.DisplayNameFor(model => model.FiscalPeriod)
      </th>
    </tr>
  </thead>
  <tbody>
    @foreach (var item in Model)
    {
      <tr>
        <td colspan="9">
          <div class="flex-sm-row">
            <a asp-action="EditAsync" asp-route-id="@item.PTFSSN" class="btn-sm btn-primary btn-outline-primary">Edit</a>
            <a asp-action="Details" asp-route-id="@item.PTFSSN" class="btn-sm btn-dark btn-outline-dark">Details</a>
            <a asp-action="Delete" asp-route-id="@item.PTFSSN" class="btn-sm btn-danger btn-outline-danger">Delete</a>
          </div>
        </td>
      </tr>
      <tr>
        <td>
          @Html.DisplayFor(modelItem => item.VISN)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Facility)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.District)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Division)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Sta6aKey)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Bedsecn)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.Name)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.PTFSSN)
        </td>
        <td>
          @Html.DisplayFor(modelItem => item.FiscalPeriod)
        </td>
      </tr>
      <tr>
        <td colspan="9" class="border-info">
          <table class="table">
            <thead>
              <tr>
                <th>
                  @Html.DisplayNameFor(modelItem => item.CareEpisodes.First().EpisodeOfCareId)
                </th>
                <th>
                  @Html.DisplayNameFor(modelItem => item.CareEpisodes.First().AdmissionDate)
                </th>
                <th>
                  @Html.DisplayNameFor(modelItem => item.CareEpisodes.First().OnsetDate)
                </th>
                <th>
                  @Html.DisplayNameFor(modelItem => item.CareEpisodes.First().PatientIcnfk)
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="9">
                  <div class="flex-sm-row">
                    <a asp-action="EditAsync" asp-route-stage="Initial" class="btn-sm btn-info btn-outline-info">Initial</a>
                    <a asp-action="EditAsync" asp-route-stage="Interim" class="btn-sm btn-secondary btn-outline-secondary">Interim</a>
                    <a asp-action="EditAsync" asp-route-stage="Discharge" class="btn-sm btn-success btn-outline-success">Discharge</a>
                    <a asp-action="EditAsync" asp-route-stage="Followup" class="btn-sm btn-warning btn-outline-warning">Followup</a>
                  </div>
                </td>
              </tr>

              @if (item.CareEpisodes?.Count() == 0)
              {
                <tr>
                  <td colspan="9" class="text-danger">
                    No epside of care
                  </td>
                </tr>
              }
              else
              {
                @foreach (var episode in item.CareEpisodes)
                {
                  <tr>
                    <td colspan="9">
                      <div class="flex-sm-row">
                        <a asp-action="EditAsync" asp-route-stage="Initial" asp-route-episodeId="@episode.EpisodeOfCareId" class="btn-sm btn-info btn-outline-info">Initial</a>
                        <a asp-action="EditAsync" asp-route-stage="Interim" asp-route-episodeId="@episode.EpisodeOfCareId" class="btn-sm btn-secondary btn-outline-secondary">Interim</a>
                        <a asp-action="EditAsync" asp-route-stage="Discharge" asp-route-episodeId="@episode.EpisodeOfCareId" class="btn-sm btn-success btn-outline-success">Discharge</a>
                        <a asp-action="EditAsync" asp-route-stage="Followup" asp-route-episodeId="@episode.EpisodeOfCareId" class="btn-sm btn-warning btn-outline-warning">Followup</a>
                      </div>
                    </td>
                  </tr>

                  <tr>
                    <td>
                      @Html.DisplayFor(modelItem => episode.EpisodeOfCareId)
                    </td>
                    <td>
                      @Html.DisplayFor(modelItem => episode.AdmissionDate)
                    </td>
                    <td>
                      @Html.DisplayFor(modelItem => episode.OnsetDate)
                    </td>
                    <td>
                      @Html.DisplayFor(modelItem => episode.PatientIcnfk)
                    </td>
                  </tr>
                }
              }
            </tbody>
          </table>
        </td>
      </tr>
    }
  </tbody>
</table>
